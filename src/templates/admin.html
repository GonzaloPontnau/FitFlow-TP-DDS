{% extends "base.html" %}

{% block title %}Panel de Administración - FitFlow{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Panel de Administración</h2>
    </div>

    <div class="admin-grid">
        <!-- Sistema de Health -->
        <div class="admin-card">
            <h3>Estado del Sistema</h3>
            <div id="health-status">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Verificando estado...</p>
                </div>
            </div>
        </div>

        <!-- Rate Limiting Info -->
        <div class="admin-card">
            <h3>Seguridad</h3>
            <ul class="admin-list">
                <li><strong>Rate Limiting:</strong> 10 peticiones/minuto en API</li>
                <li><strong>Bloqueo de IPs:</strong> Activo</li>
                <li><strong>WebSockets:</strong> Habilitado para actualizaciones en tiempo real</li>
            </ul>
        </div>

        <!-- Accesos Rápidos Admin -->
        <div class="admin-card">
            <h3>Accesos Rápidos</h3>
            <div class="admin-actions">
                <a href="/socios" class="btn btn-primary">Gestión de Socios</a>
                <a href="/clases" class="btn btn-primary">Gestión de Clases</a>
                <a href="/admin/planes" class="btn btn-primary">Gestión de Planes</a>
                <a href="/solicitudes" class="btn btn-warning">Solicitudes de Baja</a>
                <a href="/estadisticas/dashboard" class="btn btn-info">Estadísticas</a>
            </div>
        </div>

        <!-- Logs -->
        <div class="admin-card">
            <h3>Logs del Sistema</h3>
            <p>Los logs se guardan en:</p>
            <code>logs/fitflow_YYYYMMDD.log</code>
            <code>logs/fitflow_errors_YYYYMMDD.log</code>
        </div>
    </div>
</div>

<style>
    .admin-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        padding: 1rem 0;
    }

    .admin-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
    }

    .admin-card h3 {
        margin-bottom: 1rem;
        color: var(--primary-color);
    }

    .admin-list {
        list-style: none;
        padding: 0;
    }

    .admin-list li {
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .admin-actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .btn-info {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        color: white;
    }

    .btn-warning {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        color: #212529;
    }

    code {
        display: block;
        background: var(--bg-dark);
        padding: 0.5rem;
        border-radius: 4px;
        margin: 0.25rem 0;
        font-size: 0.85rem;
    }

    .health-ok {
        color: #28a745;
    }

    .health-error {
        color: #dc3545;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    async function checkHealth() {
        try {
            const response = await fetch('/health');
            const data = await response.json();

            const container = document.getElementById('health-status');
            const isHealthy = data.status === 'healthy';

            container.innerHTML = `
            <div class="${isHealthy ? 'health-ok' : 'health-error'}">
                <p><strong>Estado:</strong> ${data.status}</p>
                <p><strong>Base de datos:</strong> ${data.checks?.database?.status || 'N/A'}</p>
                <p><strong>Scheduler:</strong> ${data.checks?.scheduler?.status || 'N/A'}</p>
                <p><strong>Tiempo respuesta:</strong> ${data.response_time_ms || 'N/A'} ms</p>
            </div>
        `;
        } catch (error) {
            document.getElementById('health-status').innerHTML =
                '<div class="health-error"><p>Error al verificar estado del sistema</p></div>';
        }
    }

    document.addEventListener('DOMContentLoaded', checkHealth);
</script>
{% endblock %}